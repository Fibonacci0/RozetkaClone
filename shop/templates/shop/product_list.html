{% extends "shop/_layout.html" %}
{% load static %}

{% block title %}Товари{% endblock %}

{% block content %}

<!-- -------------------- Банери зверху -------------------- -->
{% if promos %}
<div class="container mx-auto px-4 py-6">
    <div class="relative w-full overflow-hidden rounded-lg shadow-md">
        <div class="flex transition-transform duration-500" id="promo-carousel">
            {% for promo in promos %}
            <div class="min-w-full">
                <img src="{{ promo.image.url }}" alt="{{ promo.title }}" class="w-full h-64 object-cover rounded-lg">
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- -------------------- Контейнер з фільтрами і товарами -------------------- -->
<div class="container mx-auto px-4 py-6 grid grid-cols-1 md:grid-cols-4 gap-6">

    <!-- -------------------- Бокові фільтри -------------------- -->
    <div class="md:col-span-1 bg-white p-4 rounded-lg shadow-sm">
        <h3 class="font-semibold text-lg mb-4">Фільтри</h3>
        <form method="get" action="">
            <!-- Ціна -->
            <div class="mb-4">
                <label class="block font-medium mb-1">Ціна від:</label>
                <input type="number" name="min_price" value="{{ request.GET.min_price }}" 
                       class="w-full border rounded px-2 py-1">
            </div>
            <div class="mb-4">
                <label class="block font-medium mb-1">Ціна до:</label>
                <input type="number" name="max_price" value="{{ request.GET.max_price }}" 
                       class="w-full border rounded px-2 py-1">
            </div>

            <!-- Виробник -->
            <div class="mb-4">
                <label class="block font-medium mb-1">Виробник:</label>
                <input type="text" name="manufacturer" value="{{ request.GET.manufacturer }}" 
                       class="w-full border rounded px-2 py-1">
            </div>

            <!-- Країна -->
            <div class="mb-4">
                <label class="block font-medium mb-1">Країна:</label>
                <input type="text" name="country" value="{{ request.GET.country }}" 
                       class="w-full border rounded px-2 py-1">
            </div>

            <!-- Доступність -->
            <div class="mb-4">
                <label class="inline-flex items-center">
                    <input type="checkbox" name="available" value="1" 
                           {% if request.GET.available %}checked{% endif %} class="mr-2">
                    В наявності
                </label>
            </div>

            <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                Застосувати фільтри
            </button>
        </form>
    </div>

    <!-- -------------------- Список товарів -------------------- -->
    <div class="md:col-span-3">
        <h2 class="text-2xl font-bold mb-6">
            {% if category %}{{category.name}}{% else %} Усі товари {% endif %}
        </h2>

        {% if products %}
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
            {% for product in products %}
            <div class="bg-white border border-gray-200 rounded-lg p-3 shadow-sm hover:shadow-md transition relative">
                <!-- Фото -->
                <a href="{% url 'product_detail' product.id %}">
                    <img src="{{ product.get_image }}" alt="{{ product.name }}" 
                         class="w-full h-32 object-contain mb-2 rounded">
                </a>

                <!-- Назва -->
                <p class="text-sm font-medium text-gray-800 truncate mb-1">
                    <a href="{% url 'product_detail' product.id %}">{{ product.name }}</a>
                </p>

                <!-- Рейтинг -->
                <div class="flex items-center text-yellow-400 text-xs mb-1">
                    <i class="fas fa-star mr-1"></i>
                    <span class="text-gray-800">{{ product.rating|floatformat:1|default:"0.0" }} / 5</span>
                    <span class="text-gray-500 ml-2">({{ product.review_count|default:"0" }})</span>
                </div>

                <!-- Доступність -->
                <p class="text-xs mb-1 {% if product.available %}text-green-600{% else %}text-red-500{% endif %}">
                    {% if product.available %}Є в наявності{% else %}Немає в наявності{% endif %}
                </p>

                <!-- Ціна -->
                <p class="text-base font-bold text-gray-900">{{ product.price }} ₴</p>

                <!-- Кнопка додати в кошик -->
                <div class="mt-3 text-right">
                    <button class="text-green-600 text-lg hover:text-green-800">
                        <i data-product-id="{{ product.id }}"
                           data-product-name="{{ product.name }}"
                           data-product-price="{{ product.price }}"
                           data-product-image="{{ product.get_image }}"
                           data-added="false"
                           class="fas fa-cart-plus"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-red-600 font-semibold text-center mt-6">Немає товарів</p>
        {% endif %}
    </div>

</div>

{% endblock %}
