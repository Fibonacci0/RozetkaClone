{% extends "shop/_layout.html" %}
{% load static %}

{% block content %}
<div class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50">
    <div class="bg-white rounded-2xl shadow-[3px_3px_6px_rgb(251,146,60)] w-full max-w-md">

        <div class="flex justify-between items-center p-6">
            <h1 id="reset-title" class="text-3xl font-medium">Скидання паролю</h1>
            <button class="text-3xl" onclick="window.location.href='/'">&times;</button>
        </div>

        <hr class="border-t-1 border-orange-500 w-full">

        <div id="reset-content" class="px-5 pb-5 space-y-4"></div>

    </div>

</div>

<script>
    function renderStep(step, formHtml = "") {
        const title = document.getElementById("reset-title");
        const content = document.getElementById("reset-content");

        switch (step) {
            case "request":
                title.innerText = "Скидання паролю";
                content.innerHTML = `
                    <form method="post" class="space-y-4">
                        {% csrf_token %}
                        ${formHtml}
                        <button type="submit"
                        class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-xl transition duration-200">
                        Продовжити
                        </button>
                    </form>
                `;
                break;

            case "done":
                title.innerText = "Перевірте пошту";
                content.innerHTML = `
                    <p class="text-gray-600 mt-5">
                        Ми надіслали вам інструкцію для скидання паролю на вказану електронну адресу.
                    </p>
                `;
                break;

            case "confirm":
                title.innerText = "Новий пароль";
                content.innerHTML = `
                    <form method="post" class="space-y-4">
                        {% csrf_token %}
                        ${formHtml}
                        <button type="submit"
                        class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-xl transition duration-200">
                        Змінити пароль
                        </button>
                    </form>
                `;
                break;

            case "complete":
                title.innerText = "Пароль змінено";
                content.innerHTML = `
                    <p class="text-gray-600 mt-5">
                        Ваш пароль було успішно змінено. Тепер ви можете
                        <a href="{% url 'login_email' %}" class="text-green-600 underline">увійти</a>.
                    </p>
                `;
                break;
        }
    }

    renderStep("{{ step }}", `{% for field in form %}<div>
    <label for="{{ field.id_for_label }}" class="block text-gray-500 m-1">{{ field.label }}</label>
    {{ field }}
    {% if field.errors %}
      <p class="text-red-600 text-sm">{{ field.errors|striptags }}</p>
    {% endif %}
  </div>{% endfor %}`);


</script>


{% endblock %}