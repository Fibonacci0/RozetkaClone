<div class="bg-white rounded-lg border border-gray-200 p-4 mb-4 shadow-sm">
  <!-- Review Header -->
  <div class="flex items-start justify-between mb-3">
    <div class="flex items-center space-x-3">
      <!-- User Avatar -->
      <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center text-white font-semibold text-sm">
        {{ review.user.first_name.0|default:review.user.username.0|upper }}
      </div>
      
      <div>
        <!-- User Name -->
        <div class="flex items-center space-x-2">
          <span class="font-medium text-gray-900">
            {% if review.user.first_name %}
              {{ review.user.first_name }}
            {% else %}
              {{ review.user.username }}
            {% endif %}
          </span>
          {% if review.is_verified %}
          <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
            Перевірено
          </span>
          {% endif %}
        </div>
        
        <!-- Rating and Date -->
        <div class="flex items-center space-x-3 mt-1">
          <!-- Star Rating -->
          <div class="flex items-center">
            {% for i in "12345" %}
              {% if forloop.counter <= review.rating %}
                <svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              {% else %}
                <svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              {% endif %}
            {% endfor %}
          </div>
          
          <!-- Date -->
          <span class="text-sm text-gray-500">{{ review.created_at|date:"d.m.Y" }}</span>
        </div>
      </div>
    </div>
    
    <!-- Actions Menu -->
    {% if review.user == request.user %}
    <div class="relative" x-data="{ open: false }">
      <button @click="open = !open" class="text-gray-400 hover:text-gray-600 p-1">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
        </svg>
      </button>
      
      <div x-show="open" @click.away="open = false" x-transition class="absolute right-0 mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 z-10">
        <a href="{% url 'edit_review' review.id %}" class="block px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">Редагувати</a>
        <form action="{% url 'delete_review' review.id %}" method="post">
          {% csrf_token %}
          <button type="submit" onclick="return confirm('Ви впевнені, що хочете видалити відгук?');" class="w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-gray-100">
            Видалити
          </button>
        </form>
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Product Info (if needed) -->
  {% if show_product_info and review.product %}
  <div class="mb-3 text-sm text-gray-600">
    <span class="font-medium">Продукт:</span> {{ review.product.name }}
  </div>
  {% endif %}

  <!-- Review Content -->
  {% if review.comment %}
  <div class="mb-3">
    <p class="text-gray-800 leading-relaxed">{{ review.comment }}</p>
  </div>
  {% endif %}

  <!-- Advantages and Disadvantages -->
  {% if review.advantages or review.disadvantages %}
  <div class="space-y-2 mb-3">
    {% if review.advantages %}
    <div class="text-sm">
      <span class="font-medium text-green-700">Переваги:</span>
      <span class="text-gray-700">{{ review.advantages }}</span>
    </div>
    {% endif %}
    
    {% if review.disadvantages %}
    <div class="text-sm">
      <span class="font-medium text-red-700">Недоліки:</span>
      <span class="text-gray-700">{{ review.disadvantages }}</span>
    </div>
    {% endif %}
  </div>
  {% endif %}

  <!-- Review Photos -->
  {% if review.photos.all %}
  <div class="mb-3">
    <div class="flex flex-wrap gap-2">
      {% for photo in review.photos.all %}
      <img src="{{ photo.image.url }}" alt="Review photo" class="w-16 h-16 object-cover rounded-md border cursor-pointer hover:opacity-80" onclick="openImageModal('{{ photo.image.url }}')">
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Review Footer -->
  <div class="flex items-center justify-between pt-3 border-t border-gray-100">
    <div class="flex items-center space-x-4 text-sm text-gray-500">
      <!-- Helpful buttons -->
      <button class="flex items-center space-x-1 hover:text-green-600 transition-colors" onclick="likeReview({{ review.id }})">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
        </svg>
        <span>{{ review.likes_count|default:0 }}</span>
      </button>
      
      <button class="flex items-center space-x-1 hover:text-red-600 transition-colors" onclick="dislikeReview({{ review.id }})">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018c.163 0 .326.02.485.06L17 4m-7 10v5a2 2 0 002 2h.095c.5 0 .905-.405.905-.905 0-.714.211-1.412.608-2.006L17 13V4m-7 10h2M17 4H19a2 2 0 012 2v6a2 2 0 01-2 2h-2.5"/>
        </svg>
        <span>{{ review.dislikes_count|default:0 }}</span>
      </button>
      
      <button class="hover:text-blue-600 transition-colors" onclick="replyToReview({{ review.id }})">
        Відповісти
      </button>
    </div>
    
    {% if review.updated_at and review.updated_at != review.created_at %}
    <span class="text-xs text-gray-400">
      Оновлено {{ review.updated_at|date:"d.m.Y" }}
    </span>
    {% endif %}
  </div>
</div>

<!-- Image Modal (add to your base template) -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center" onclick="closeImageModal()">
  <div class="max-w-4xl max-h-4xl p-4">
    <img id="modalImage" src="" alt="Review photo" class="max-w-full max-h-full object-contain rounded-lg">
  </div>
</div>

<script>
function openImageModal(imageSrc) {
  document.getElementById('modalImage').src = imageSrc;
  document.getElementById('imageModal').classList.remove('hidden');
}

function closeImageModal() {
  document.getElementById('imageModal').classList.add('hidden');
}

function likeReview(reviewId) {
  // Add your AJAX call here to handle like functionality
  fetch(`/reviews/${reviewId}/like/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
      'Content-Type': 'application/json',
    },
  })
  .then(response => response.json())
  .then(data => {
    // Update the like count in the UI
    location.reload(); // Simple reload, or update DOM dynamically
  });
}

function dislikeReview(reviewId) {
  // Add your AJAX call here to handle dislike functionality
  fetch(`/reviews/${reviewId}/dislike/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
      'Content-Type': 'application/json',
    },
  })
  .then(response => response.json())
  .then(data => {
    // Update the dislike count in the UI
    location.reload(); // Simple reload, or update DOM dynamically
  });
}

function replyToReview(reviewId) {
  // Add functionality to show reply form or navigate to reply
  console.log('Reply to review:', reviewId);
}
</script>